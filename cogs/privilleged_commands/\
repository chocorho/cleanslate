import secret

import datetime

import discord
from discord.ext import commands


class Redact(commands.Cog):
    def __init__(self, bot):
        self.bot = bot


    @commands.command(aliases=["purge"])
    async def redact(self, message, target):
        if (None == target):
            await message.channel.send('target not specified. Try again.')
            return

        if (message.author.id not in secret.credentials.privileged_users):
            await message.channel.send("no perms, byebye")
            return
        
        await message.channel.send(f"Deleting messages for {target}...")
        end_date = datetime.datetime(2021, 5, 1)
        async for historical_message in message.channel.history(limit=None, before=end_date):
            if (target == historical_message.author.id):
                print(f"now deleting the next message, from {message.created_at}")
                historical_message.delete()
                time.sleep(5)

async def setup(bot):
    await bot.add_cog(Redact(bot))
